---
title: "Analysis"
author: "Susie and Teddie"
format: pdf
---
Packages: 

```{r}
library(tidyverse)
library(MASS)
library(ordinal)
```


Read in data: 
```{r}
data <- read_csv("ISSP_OECD2015.csv")
data

glimpse(data)
```

Drop rows with missing values, except for ISCO column. (Per PI)

```{r}
data_clean <- data%>%
  dplyr::select(-isco)%>%
  tidyr::drop_na()

data_clean$jobsec <- factor(data_clean$jobsec, ordered = TRUE, 
                             levels = c("Strongly disagree", "Disagree", "Neither nor", "Agree", "Strongly agree"))

#data_clean <- data_clean%>%
#  filter(relmgmt %in% c("Very bad", "Quite bad"))
 
data_clean$rmgt3 <- data_clean$relmgmt
data_clean$rmgt3[data_clean$relmgmt %in% c("Very bad", "Quite bad")] <- "Bad"
data_clean$rmgt3[data_clean$relmgmt %in% c("Very good", "Quite good")] <- "Good"
data_clean$rmgt3 <- factor(data_clean$rmgt3)

#data_clean$relmgmt <- factor(data_clean$relmgmt, ordered = F, 
                             #levels = c("Very bad", "Quite bad", "Neither nor", "Quite good", "Very good"))


glimpse(data_clean)
```
Response, y = jobsec.  5 level ordinal response. 

Fixed effect with clm(): 

```{r}

fit0 <- clm(jobsec~ relmgmt + unemp +ltu + sex + age + sector + fulltime + union, data = data_clean)

fit1 <- clm(jobsec~ eprc + relmgmt + unemp +ltu + sex + age + sector + fulltime + union, data = data_clean)

fit2 <- clm(jobsec~ eprc * relmgmt + unemp +ltu + sex + age + sector + fulltime + union, data = data_clean)

summary(fit1)
summary(fit2)

anova(fit0, fit1, fit2)

anova(fit0, fit2)

```

Ordinal logistic regression mixed effects model with country as random effect, with clmm(): 

```{r}
fit3 <- clmm(jobsec~ eprc * rmgt3 + unemp +ltu + sex + age + sector + fulltime + union + (1|country), data = data_clean)

summary(fit3)
```


```{r}
AIC(fit1,fit2,fit3)
BIC(fit1,fit2,fit3)
```





Odds: 

bad neutral good, some way to combine odds? 

Job security 5 levels.  


Graphs.  3 graphs, 5 lines each.  Xaxis is eprc, y axis is probability of a specific level of job security. each graph corresponds to one level of relmgmgt. 

```{r}
library(effects)
Effect("eprc", fit3) %>% plot()

library(marginaleffects)
plot_cap(fit3, condition = c("eprc", "rmgt3"))

```




